defaults: &defaults
  working_directory: ~/lcs-img-diff
  docker:
    - image: node
      environment:
        DISPLAY: ":99"

version: 2
jobs:
  build:
    <<: *defaults
    steps:
      - checkout  
      - run:
          name: Test
          command: |
            curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain stable && \
            PATH="/root/.cargo/bin:$PATH" rustup install stable && \
            PATH="/root/.cargo/bin:$PATH" rustup install nightly
            apt-get install -y bzip2-devel gcc gcc-c++ libgcc cmake wget git openssl-devel readline-devel sqlite-devel zip            npm i
            make build
            npm t   
